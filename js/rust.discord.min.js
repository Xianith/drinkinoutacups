var game_list = [];
var top_games = [];

var user_list = [
{"name":"Xianith","role":"admin","steam":"http://steamcommunity.com/id/xianith"},
{"name":"head of the ins","role":"admin","steam":"http://steamcommunity.com/id/HeadoftheINS"},
//{"name":"ikiled","role":"mod","steam":"http://steamcommunity.com/profiles/76561198134189030"},
//{"name":"IrishLuv","role":"mod","steam":"http://steamcommunity.com/id/IrishLuvv"},
//{"name":"Ima Cat Meow","role":"mod","steam":"http://steamcommunity.com/profiles/76561198119450941"},
{"name":"Cromis","role":"mod","steam":"http://steamcommunity.com/profiles/76561198052352774"},
];

var white_list = [];
// for (var t = 0; t < y.channels.length; t++) {
for (var wl = 0; wl < user_list.length; wl++)
{
    console.log(user_list[wl].name);
    white_list.push(user_list[wl].name);
}

console.log(white_list);

var discordWidget = discordWidget || (function() {
    var b = {};
    var a = "1.0";
    var x = 0;
    return {
        init: function(c) {
            b.serverId = c.serverId;
            b.alphabetical = c.alphabetical;
            b.theme = c.theme;
            b.hideChannels = c.hideChannels;
            b.showAllUsers = c.showAllUsers;
            b.allUsersDefaultState = c.allUsersDefaultState
        },
        render: function() {
            if (window.jQuery) {
                d()
            } else {
                var c = document.createElement("script");
                c.type = "text/javascript";
                c.src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js";
                document.head.appendChild(c);
                c.onload = function() {
                    d()
                }
            }

            function d() {
                $("head").append('<link rel="stylesheet" href="../css/discord.css" type="text/css" />');
                var h = "https://discordapp.com/api/servers/" + b.serverId + "/embed.json";
                var i = new XMLHttpRequest();
                i.onreadystatechange = function() {
                    if (i.readyState == 4 && i.status == 200) {
                        var l = JSON.parse(i.responseText);
                        j(l, b);
                        if (!b.allUsersDefaultState) {
                            $(".discord-allusers").toggle();
                            $(".discord-allusers-toggle").html("&#9656; Online Users")
                        }
                        // $(".discord-allusers-toggle").click(function() {
                        //     $(".discord-allusers").toggle(100, function() {
                        //         if ($(".discord-allusers").is(":visible")) {
                        //             $(".discord-allusers-toggle").html("&#9662; Online Users")
                        //         } else {
                        //             $(".discord-allusers-toggle").html("&#9656; Online Users")
                        //         }
                        //     })
                        // })
                    } else {
                        if (i.readyState == 4 && i.status == 404) {
                            j("404", b)
                        } else {
                            if (i.readyState == 4 && i.status != 404) {
                                j(i.status, b)
                            }
                        }
                    }
                };
                i.open("GET", h, true);
                i.send();

                function e(m, l) {
                    if (m.position < l.position) {
                        return -1
                    }
                    if (m.position > l.position) {
                        return 1
                    }
                    return 0
                }

                function f(n, l) {
                    var m = "";
                    if (n.game) {
                        m = " - " + n.game.name
                        game_list[x] = n.game.name;
                        x++;
                    }

                    if (n.channel_id == l && n.bot != true) {
                        if (n.status != "online") {
                            if (jQuery.inArray(n.username,white_list) !== -1) {
                            var local = white_list.indexOf(n.username);
                            var roleStyle = '';
                            if (user_list[local].role == "mod") { roleStyle = '#7289DA';}
                            if (user_list[local].role == "admin") { roleStyle = '#FFC003';}
                            $( ".staffonduty" ).show();
                            return '<li class="discord-user"><img src="' + n.avatar_url + '" class="discord-avatar"></div><a href="'+ user_list[local].steam +'" style = "color:'+roleStyle+' !important">' + n.username + '</a></a></li>'
                            } else {
                                return ""
                            }
                        } else {
                            if (jQuery.inArray(n.username,white_list) !== -1) {
                            // return '<li class="discord-user"><a href="http://steamcommunity.com/id/' + n.username + '/"><img src="' + n.avatar_url + '" class="discord-avatar discord-online"/></div>' + n.username + "</a><span>" + m + "</span></li>"
                            var local = white_list.indexOf(n.username);
                             var roleStyle = '';
                            if (user_list[local].role == "mod") { roleStyle = '#7289DA';}
                            if (user_list[local].role == "admin") { roleStyle = '#FFC003';}
                            $( ".staffonduty" ).show();
                            return '<li class="discord-user"><img src="' + n.avatar_url + '" class="discord-avatar"></div><a href="'+ user_list[local].steam +'" style = "color:'+roleStyle+' !important">' + n.username + '</a></a></li>'
                            } else {
                                return ""
                            }
                		}
                    } else {
                        return ""
                    }
                }

                function j(y, n) {
                    var z = $(".discord-widget")[0];
                    $(z).attr("version", a);
                    // var A = '<ul class="discord-tree"></ul><p class="discord-users-online"></p><p class="discord-join"></p><div class="discord-fade"></div>';
                    var A = '<ul class="discord-tree"></ul>';
                    var u = "";
                    var r = "";
                    var l, w, x;
                    var v, m, q, o;
                    z.innerHTML = A;
                    l = $(".discord-tree")[0];
                    l.style.marginTop = "0"
                    if (n.title !== false) {
                        // z.innerHTML = '<div class="discord-title"><h3>' + n.title + "</h3></div>" + A;
                        l = $(".discord-tree")[0]
                    } else {
                        z.innerHTML = A;
                        l = $(".discord-tree")[0];
                        l.style.marginTop = "0"
                    }
                    switch (y) {
                        case "404":
                            l.innerHTML = '<span class="discord-error">Invalid Server ID</span>';
                            break;
                        case "522":
                            l.innerHTML = '<span class="discord-error">Discord is having issues.</span>';
                            break
                    }
                    if (!y) {
                        l.innerHTML = y;
                        return
                    }
                    w = $(".discord-users-online")[0];
                    x = $(".discord-join")[0];
                    if (n.alphabetical) {
                        v = [];
                        o = [];
                        for (var t = 0; t < y.channels.length; t++) {
                            q = false;
                            for (var s = 0; s < n.hideChannels.length; s++) {
                                if (y.channels[t].name.includes(n.hideChannels[s])) {
                                    q = true
                                }
                            }
                            if (!q) {
                                v.push(y.channels[t])
                            } else {
                                o.push(y.channels[t].id)
                            }
                        }
                        for (var t = 0; t < v.length; t++) {
                            // u += g(v[t].name);
                            for (var s = 0; s < y.members.length; s++) {
                                u += f(y.members[s], v[t].id)
                            }
                            u += "</ul>"
                        }
                    } else {
                        v = [];
                        o = [];
                        for (var t = 0; t < y.channels.length; t++) {
                            q = false;
                            for (var s = 0; s < n.hideChannels.length; s++) {
                                if (y.channels[t].name.includes(n.hideChannels[s])) {
                                    q = true
                                }
                            }
                            if (!q) {
                                v.push(y.channels[t])
                            } else {
                                o.push(y.channels[t].id)
                            }
                        }
                        v.sort(e);
                        for (var t = 0; t < v.length; t++) {
                            // u += g(v[t].name);
                            for (var s = 0; s < y.members.length; s++) {
                                u += f(y.members[s], v[t].id)
                            }
                            u += "</ul>"
                        }
                    }
                    if (n.showAllUsers) {
                        u += '<ul class="discord-userlist discord-allusers">';
						// u += '<li class="discord-channel discord-allusers-toggle">&#9662; Online Users</li><ul class="discord-userlist discord-allusers">';
                        for (var t = 0; t < y.members.length; t++) {
                            if (!y.members[t].channel_id || $.inArray(y.members[t].channel_id, o) >= 0) {
                                u += f(y.members[t], y.members[t].channel_id)
                            }
                        }
                        u += "</ul>"
                    }
                    var B = "";
                    if (y.instant_invite != "null") {
                        B = '<a href="' + y.instant_invite + '">Join Server</a>'
                    }
                    l.innerHTML = u;
                }
            }
        }
    }
}());